<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Control de Inventario de Computadoras</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>
</head>
<body class="bg-gray-100 text-gray-800 font-sans">
    <header class="bg-slate-800 text-white py-6">
        <div class="container mx-auto px-4">
            <h1 class="text-2xl md:text-3xl font-bold text-center">Sistema de Control de Inventario de Computadoras</h1>
        </div>
    </header>

    <div class="container mx-auto px-4 py-6">
        <!-- Resumen/Estadísticas -->
        <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-4 mb-6">
            <div class="bg-white p-4 rounded-lg shadow text-center">
                <h3 class="font-semibold text-gray-600">Total</h3>
                <div id="count-total" class="text-2xl font-bold">0</div>
            </div>
            <div class="bg-white p-4 rounded-lg shadow text-center">
                <h3 class="font-semibold text-gray-600">Buena</h3>
                <div id="count-buena" class="text-2xl font-bold text-green-600">0</div>
            </div>
            <div class="bg-white p-4 rounded-lg shadow text-center">
                <h3 class="font-semibold text-gray-600">No Funciona</h3>
                <div id="count-no-funciona" class="text-2xl font-bold text-red-600">0</div>
            </div>
            <div class="bg-white p-4 rounded-lg shadow text-center">
                <h3 class="font-semibold text-gray-600">Poco Rendimiento</h3>
                <div id="count-poco-rendimiento" class="text-2xl font-bold text-yellow-600">0</div>
            </div>
            <div class="bg-white p-4 rounded-lg shadow text-center">
                <h3 class="font-semibold text-gray-600">Excelente</h3>
                <div id="count-excelente" class="text-2xl font-bold text-blue-600">0</div>
            </div>
        </div>

        <!-- Barra de búsqueda -->
        <div class="flex flex-col md:flex-row gap-2 mb-6">
            <input type="text" id="search-input" placeholder="Buscar por código, marca, modelo o ubicación..." 
                   class="flex-1 p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:outline-none">
            <div class="flex gap-2">
                <button class="bg-blue-600 hover:bg-blue-700 text-white py-3 px-4 rounded-lg transition-colors" onclick="searchInventory()">
                    Buscar
                </button>
                <button class="bg-gray-500 hover:bg-gray-600 text-white py-3 px-4 rounded-lg transition-colors" onclick="clearSearch()">
                    Limpiar
                </button>
            </div>
        </div>

        <!-- Formulario -->
        <div class="bg-white rounded-lg shadow-md p-6 mb-6">
            <h2 class="text-xl font-bold mb-4">Agregar Nueva Computadora</h2>
            <form id="inventory-form" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                <div>
                    <label for="codigo" class="block font-medium mb-1">Código de Inventario:</label>
                    <input type="text" id="codigo" required 
                           class="w-full p-2 border border-gray-300 rounded focus:ring-2 focus:ring-blue-500 focus:outline-none">
                </div>
                <div>
                    <label for="marca" class="block font-medium mb-1">Marca:</label>
                    <input type="text" id="marca" required 
                           class="w-full p-2 border border-gray-300 rounded focus:ring-2 focus:ring-blue-500 focus:outline-none">
                </div>
                <div>
                    <label for="modelo" class="block font-medium mb-1">Modelo:</label>
                    <input type="text" id="modelo" required 
                           class="w-full p-2 border border-gray-300 rounded focus:ring-2 focus:ring-blue-500 focus:outline-none">
                </div>
                <div>
                    <label for="procesador" class="block font-medium mb-1">Procesador:</label>
                    <input type="text" id="procesador" required 
                           class="w-full p-2 border border-gray-300 rounded focus:ring-2 focus:ring-blue-500 focus:outline-none">
                </div>
                <div>
                    <label for="ram" class="block font-medium mb-1">RAM (GB):</label>
                    <input type="number" id="ram" required 
                           class="w-full p-2 border border-gray-300 rounded focus:ring-2 focus:ring-blue-500 focus:outline-none">
                </div>
                <div>
                    <label for="almacenamiento" class="block font-medium mb-1">Almacenamiento (GB):</label>
                    <input type="number" id="almacenamiento" required 
                           class="w-full p-2 border border-gray-300 rounded focus:ring-2 focus:ring-blue-500 focus:outline-none">
                </div>
                <div>
                    <label for="estado" class="block font-medium mb-1">Estado:</label>
                    <select id="estado" required 
                            class="w-full p-2 border border-gray-300 rounded focus:ring-2 focus:ring-blue-500 focus:outline-none">
                        <option value="">-- Seleccionar Estado --</option>
                        <option value="Buena">Buena</option>
                        <option value="No funciona">No funciona</option>
                        <option value="Muy poco rendimiento">Muy poco rendimiento</option>
                        <option value="Excelente rendimiento">Excelente rendimiento</option>
                    </select>
                </div>
                <div>
                    <label for="ubicacion" class="block font-medium mb-1">Ubicación en Bodega:</label>
                    <input type="text" id="ubicacion" required 
                           class="w-full p-2 border border-gray-300 rounded focus:ring-2 focus:ring-blue-500 focus:outline-none">
                </div>
                <div>
                    <label for="fecha" class="block font-medium mb-1">Fecha de ingreso:</label>
                    <input type="date" id="fecha" required 
                           class="w-full p-2 border border-gray-300 rounded focus:ring-2 focus:ring-blue-500 focus:outline-none">
                </div>
                <div class="md:col-span-2 lg:col-span-3">
                    <label for="notas" class="block font-medium mb-1">Notas adicionales:</label>
                    <textarea id="notas" rows="3" 
                              class="w-full p-2 border border-gray-300 rounded focus:ring-2 focus:ring-blue-500 focus:outline-none"></textarea>
                </div>
                <div class="md:col-span-2 lg:col-span-3">
                    <button type="submit" class="bg-blue-600 hover:bg-blue-700 text-white py-2 px-4 rounded transition-colors">
                        Guardar Computadora
                    </button>
                </div>
            </form>
        </div>

        <!-- Botones de exportación -->
        <div class="flex flex-wrap gap-2 mb-6">
            <button class="bg-amber-500 hover:bg-amber-600 text-white py-2 px-4 rounded transition-colors" onclick="exportToCSV()">
                Exportar a CSV
            </button>
            <button class="bg-amber-500 hover:bg-amber-600 text-white py-2 px-4 rounded transition-colors" onclick="exportToJSON()">
                Exportar a JSON
            </button>
            <button class="bg-amber-500 hover:bg-amber-600 text-white py-2 px-4 rounded transition-colors" onclick="exportToPDF()">
                Exportar a PDF
            </button>
        </div>

        <!-- Tabla responsiva -->
        <div class="overflow-x-auto bg-white rounded-lg shadow">
            <table id="inventory-table" class="min-w-full divide-y divide-gray-200">
                <thead class="bg-gray-800 text-white">
                    <tr>
                        <th class="px-4 py-3 text-left text-xs font-medium uppercase tracking-wider">Código</th>
                        <th class="px-4 py-3 text-left text-xs font-medium uppercase tracking-wider">Marca</th>
                        <th class="px-4 py-3 text-left text-xs font-medium uppercase tracking-wider">Modelo</th>
                        <th class="px-4 py-3 text-left text-xs font-medium uppercase tracking-wider hidden md:table-cell">Procesador</th>
                        <th class="px-4 py-3 text-left text-xs font-medium uppercase tracking-wider hidden md:table-cell">RAM</th>
                        <th class="px-4 py-3 text-left text-xs font-medium uppercase tracking-wider hidden lg:table-cell">Almac.</th>
                        <th class="px-4 py-3 text-left text-xs font-medium uppercase tracking-wider">Estado</th>
                        <th class="px-4 py-3 text-left text-xs font-medium uppercase tracking-wider hidden md:table-cell">Ubicación</th>
                        <th class="px-4 py-3 text-left text-xs font-medium uppercase tracking-wider hidden lg:table-cell">Fecha</th>
                        <th class="px-4 py-3 text-left text-xs font-medium uppercase tracking-wider">Acciones</th>
                    </tr>
                </thead>
                <tbody id="inventory-body" class="divide-y divide-gray-200">
                    <!-- Los datos del inventario se cargarán aquí dinámicamente -->
                </tbody>
            </table>
        </div>
    </div>

    <!-- Modal para ver detalles en dispositivos móviles -->
    <div id="details-modal" class="fixed inset-0 bg-gray-900 bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-lg shadow-lg p-6 m-4 max-w-xl w-full max-h-full overflow-y-auto">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-lg font-bold" id="modal-title">Detalles de Computadora</h3>
                <button onclick="closeModal()" class="text-gray-500 hover:text-gray-700">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>
            <div id="modal-content" class="space-y-3">
                <!-- Contenido del modal se cargará dinámicamente -->
            </div>
            <div class="mt-6 flex justify-end gap-2">
                <button onclick="closeModal()" class="bg-gray-500 hover:bg-gray-600 text-white py-2 px-4 rounded">
                    Cerrar
                </button>
            </div>
        </div>
    </div>

    <script>
        // Inicializar el array de inventario
        let inventario = JSON.parse(localStorage.getItem('inventarioComputadoras')) || [];
        let editingId = null;

        // Cargar los datos cuando la página se cargue
        document.addEventListener('DOMContentLoaded', function() {
            renderInventoryTable();
            document.getElementById('inventory-form').addEventListener('submit', handleFormSubmit);
            updateSummary();
        });

        // Manejar el envío del formulario
        function handleFormSubmit(e) {
            e.preventDefault();
            
            // Obtener valores del formulario
            const codigo = document.getElementById('codigo').value;
            const marca = document.getElementById('marca').value;
            const modelo = document.getElementById('modelo').value;
            const procesador = document.getElementById('procesador').value;
            const ram = document.getElementById('ram').value;
            const almacenamiento = document.getElementById('almacenamiento').value;
            const estado = document.getElementById('estado').value;
            const ubicacion = document.getElementById('ubicacion').value;
            const notas = document.getElementById('notas').value;
            const fecha = document.getElementById('fecha').value;
            
            // Validar que el código no esté duplicado cuando es un nuevo registro
            if (!editingId && inventario.some(item => item.codigo === codigo)) {
                alert('¡El código de inventario ya existe! Por favor use otro código.');
                return;
            }

            // Crear el objeto computadora
            const computadora = {
                id: editingId || Date.now().toString(),
                codigo,
                marca,
                modelo,
                procesador,
                ram,
                almacenamiento,
                estado,
                ubicacion,
                notas,
                fecha
            };

            // Si estamos editando, actualizar el elemento existente
            if (editingId) {
                const index = inventario.findIndex(item => item.id === editingId);
                if (index !== -1) {
                    inventario[index] = computadora;
                }
                editingId = null;
            } else {
                // Agregar al array de inventario
                inventario.push(computadora);
            }

            // Guardar en localStorage
            localStorage.setItem('inventarioComputadoras', JSON.stringify(inventario));
            
            // Renderizar la tabla actualizada
            renderInventoryTable();
            updateSummary();
            
            // Limpiar el formulario
            document.getElementById('inventory-form').reset();
        }

        // Renderizar la tabla de inventario
        function renderInventoryTable(items = inventario) {
            const tbody = document.getElementById('inventory-body');
            tbody.innerHTML = '';
            
            if (items.length === 0) {
                tbody.innerHTML = '<tr><td colspan="10" class="text-center py-4">No hay computadoras en el inventario</td></tr>';
                return;
            }

            items.forEach(item => {
                const tr = document.createElement('tr');
                tr.className = 'hover:bg-gray-50';
                
                // Determinar la clase CSS basada en el estado
                let statusClass = '';
                if (item.estado === 'Buena') statusClass = 'text-green-600 font-medium';
                else if (item.estado === 'No funciona') statusClass = 'text-red-600 font-medium';
                else if (item.estado === 'Muy poco rendimiento') statusClass = 'text-yellow-600 font-medium';
                else if (item.estado === 'Excelente rendimiento') statusClass = 'text-blue-600 font-medium';
                
                tr.innerHTML = `
                    <td class="px-4 py-3 whitespace-nowrap">${item.codigo}</td>
                    <td class="px-4 py-3 whitespace-nowrap">${item.marca}</td>
                    <td class="px-4 py-3 whitespace-nowrap">${item.modelo}</td>
                    <td class="px-4 py-3 whitespace-nowrap hidden md:table-cell">${item.procesador}</td>
                    <td class="px-4 py-3 whitespace-nowrap hidden md:table-cell">${item.ram} GB</td>
                    <td class="px-4 py-3 whitespace-nowrap hidden lg:table-cell">${item.almacenamiento} GB</td>
                    <td class="px-4 py-3 whitespace-nowrap ${statusClass}">${item.estado}</td>
                    <td class="px-4 py-3 whitespace-nowrap hidden md:table-cell">${item.ubicacion}</td>
                    <td class="px-4 py-3 whitespace-nowrap hidden lg:table-cell">${formatDate(item.fecha)}</td>
                    <td class="px-4 py-3 whitespace-nowrap">
                        <div class="flex flex-col md:flex-row gap-2">
                            <button class="bg-blue-600 hover:bg-blue-700 text-white py-1 px-2 rounded text-xs md:text-sm" onclick="editItem('${item.id}')">
                                Editar
                            </button>
                            <button class="bg-red-600 hover:bg-red-700 text-white py-1 px-2 rounded text-xs md:text-sm" onclick="deleteItem('${item.id}')">
                                Eliminar
                            </button>
                            <button class="md:hidden bg-gray-600 hover:bg-gray-700 text-white py-1 px-2 rounded text-xs" onclick="showDetails('${item.id}')">
                                Detalles
                            </button>
                        </div>
                    </td>
                `;
                
                tbody.appendChild(tr);
            });
        }

        // Mostrar detalles en modal para dispositivos móviles
        function showDetails(id) {
            const item = inventario.find(pc => pc.id === id);
            if (!item) return;
            
            const modal = document.getElementById('details-modal');
            const content = document.getElementById('modal-content');
            
            content.innerHTML = `
                <div class="grid grid-cols-1 gap-2">
                    <div><span class="font-medium">Código:</span> ${item.codigo}</div>
                    <div><span class="font-medium">Marca:</span> ${item.marca}</div>
                    <div><span class="font-medium">Modelo:</span> ${item.modelo}</div>
                    <div><span class="font-medium">Procesador:</span> ${item.procesador}</div>
                    <div><span class="font-medium">RAM:</span> ${item.ram} GB</div>
                    <div><span class="font-medium">Almacenamiento:</span> ${item.almacenamiento} GB</div>
                    <div><span class="font-medium">Estado:</span> ${item.estado}</div>
                    <div><span class="font-medium">Ubicación:</span> ${item.ubicacion}</div>
                    <div><span class="font-medium">Fecha:</span> ${formatDate(item.fecha)}</div>
                    <div><span class="font-medium">Notas:</span> ${item.notas || 'No hay notas adicionales'}</div>
                </div>
            `;
            
            modal.classList.remove('hidden');
        }

        // Cerrar modal
        function closeModal() {
            document.getElementById('details-modal').classList.add('hidden');
        }

        // Formatear fecha para mostrar
        function formatDate(dateString) {
            const options = { year: 'numeric', month: '2-digit', day: '2-digit' };
            return new Date(dateString).toLocaleDateString('es-ES', options);
        }

        // Editar un elemento
        function editItem(id) {
            const item = inventario.find(pc => pc.id === id);
            if (!item) return;
            
            document.getElementById('codigo').value = item.codigo;
            document.getElementById('marca').value = item.marca;
            document.getElementById('modelo').value = item.modelo;
            document.getElementById('procesador').value = item.procesador;
            document.getElementById('ram').value = item.ram;
            document.getElementById('almacenamiento').value = item.almacenamiento;
            document.getElementById('estado').value = item.estado;
            document.getElementById('ubicacion').value = item.ubicacion;
            document.getElementById('notas').value = item.notas;
            document.getElementById('fecha').value = item.fecha;
            
            editingId = id;
            
            // Hacer scroll hasta el formulario
            document.querySelector('form').scrollIntoView({ behavior: 'smooth' });
        }

        // Eliminar un elemento
        function deleteItem(id) {
            if (confirm('¿Está seguro que desea eliminar esta computadora del inventario?')) {
                inventario = inventario.filter(item => item.id !== id);
                localStorage.setItem('inventarioComputadoras', JSON.stringify(inventario));
                renderInventoryTable();
                updateSummary();
            }
        }

        // Buscar en el inventario
        function searchInventory() {
            const searchTerm = document.getElementById('search-input').value.toLowerCase();
            if (!searchTerm) {
                renderInventoryTable();
                return;
            }
            
            const filteredItems = inventario.filter(item => 
                item.codigo.toLowerCase().includes(searchTerm) ||
                item.marca.toLowerCase().includes(searchTerm) ||
                item.modelo.toLowerCase().includes(searchTerm) ||
                item.ubicacion.toLowerCase().includes(searchTerm) ||
                item.procesador.toLowerCase().includes(searchTerm) ||
                item.estado.toLowerCase().includes(searchTerm)
            );
            
            renderInventoryTable(filteredItems);
        }

        // Limpiar búsqueda
        function clearSearch() {
            document.getElementById('search-input').value = '';
            renderInventoryTable();
        }

        // Actualizar el resumen de conteos
        function updateSummary() {
            document.getElementById('count-total').textContent = inventario.length;
            document.getElementById('count-buena').textContent = 
                inventario.filter(item => item.estado === 'Buena').length;
            document.getElementById('count-no-funciona').textContent = 
                inventario.filter(item => item.estado === 'No funciona').length;
            document.getElementById('count-poco-rendimiento').textContent = 
                inventario.filter(item => item.estado === 'Muy poco rendimiento').length;
            document.getElementById('count-excelente').textContent = 
                inventario.filter(item => item.estado === 'Excelente rendimiento').length;
        }

        // Exportar a CSV
        function exportToCSV() {
            if (inventario.length === 0) {
                alert('No hay datos para exportar');
                return;
            }
            
            const headers = ['Código', 'Marca', 'Modelo', 'Procesador', 'RAM (GB)', 'Almacenamiento (GB)', 'Estado', 'Ubicación', 'Notas', 'Fecha'];
            const csvContent = [
                headers.join(','),
                ...inventario.map(item => [
                    item.codigo,
                    item.marca,
                    item.modelo,
                    item.procesador,
                    item.ram,
                    item.almacenamiento,
                    item.estado,
                    item.ubicacion,
                    item.notas ? `"${item.notas.replace(/"/g, '""')}"` : '',
                    item.fecha
                ].join(','))
            ].join('\n');
            
            downloadFile(csvContent, 'inventario-computadoras.csv', 'text/csv');
        }

        // Exportar a JSON
        function exportToJSON() {
            if (inventario.length === 0) {
                alert('No hay datos para exportar');
                return;
            }
            
            const jsonContent = JSON.stringify(inventario, null, 2);
            downloadFile(jsonContent, 'inventario-computadoras.json', 'application/json');
        }

        // Exportar a PDF
        function exportToPDF() {
            if (inventario.length === 0) {
                alert('No hay datos para exportar');
                return;
            }
            
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            // Título
            doc.setFontSize(18);
            doc.text('Inventario de Computadoras', 14, 20);
            
            // Fecha de generación
            doc.setFontSize(10);
            doc.text(`Generado el: ${new Date().toLocaleDateString('es-ES')}`, 14, 30);
            
            // Resumen
            doc.setFontSize(12);
            doc.text('Resumen:', 14, 40);
            doc.setFontSize(10);
            doc.text(`Total: ${inventario.length}`, 14, 50);
            doc.text(`Buena: ${inventario.filter(item => item.estado === 'Buena').length}`, 14, 55);
            doc.text(`No funciona: ${inventario.filter(item => item.estado === 'No funciona').length}`, 14, 60);
            doc.text(`Poco rendimiento: ${inventario.filter(item => item.estado === 'Muy poco rendimiento').length}`, 14, 65);
            doc.text(`Excelente: ${inventario.filter(item => item.estado === 'Excelente rendimiento').length}`, 14, 70);
            
            // Tabla
            const headers = ['Código', 'Marca', 'Modelo', 'Estado', 'Ubicación'];
            const rows = inventario.map(item => [
                item.codigo,
                item.marca,
                item.modelo,
                item.estado,
                item.ubicacion
            ]);
            
            doc.autoTable({
                startY: 80,
                head: [headers],
                body: rows,
                theme: 'striped',
                styles: { fontSize: 8 }
            });
            
            doc.save('inventario-computadoras.pdf');
        }

        // Función genérica para descargar archivos
        function downloadFile(content, fileName, contentType) {
            const blob = new Blob([content], { type: contentType });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = fileName;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }
    </script>
</body>
</html>
